<!DOCTYPE html>
<html lang="en">
<head>
    <title>Projects</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <style>
        #project-table tbody tr.selected {
            background-color: #d0ebff;
        }
    </style>

</head>

<body class="container mt-5">
    <h2>Projects</h2>
    <table id="project-table" class="display">
        <thead><tr><th>ID</th><th>Title</th><th>Status</th></tr></thead>
        <tbody>
        {% for project in projects %}
            <tr><td>{{ project.id }}</td><td>{{ project.title }}</td><td>{{ project.status }} </td></tr>
        {% endfor %}
        </tbody>
    </table>

    <div id="measures" class="mt-4">
        <h3 id="measures-title">Measures</h3>
        <div id="measures-placeholder" class="text-muted">Select a project to view measures.</div>
    
        <table id="measures-table" class="table table-bordered d-none">
            <thead><tr><th>ID</th><th>Type</th><th>Install Date</th></tr></thead>
            <tbody id="measures-body"></tbody>
        </table>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function() {
        
        const table = $('#project-table').DataTable();

        $('#project-table tbody').on('click', 'tr', function () {
    const isSelected = $(this).hasClass('selected');
    $('#project-table tbody tr').removeClass('selected');

    if (isSelected) {
        // Deselect and show placeholder
        $('#measures-title').text('Measures');
        $('#measures-table').addClass('d-none');
        $('#measures-placeholder').removeClass('d-none');
    } else {
        $(this).addClass('selected');
        const data = table.row(this).data();
        const projectId = data[0];
        const projectTitle = data[1];

        $('#measures-title').text(`Measures for Project: ${projectTitle}`);
        $('#measures-placeholder').addClass('d-none');
        $('#measures-table').removeClass('d-none');

        fetch(`/measures/${projectId}`)
            .then(response => response.json())
            .then(measures => {
                const tbody = $('#measures-body');
                tbody.empty();
                if (measures.length === 0) {
                    tbody.append('<tr><td colspan="3">No measures found.</td></tr>');
                } else {
                    for (let m of measures) {
                        tbody.append(
                            `<tr>
                                <td>${m.id}</td>
                                <td>${m.measure_type}</td>
                                <td>${m.install_date}</td>
                            </tr>`
                        );
                    }
                }
            });
    }
});
 
    });
    </script>

    <a href="/add" class="btn btn-primary mb-3">Add Project</a>
</body>
</html>